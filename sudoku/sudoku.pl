%% https://www.metalevel.at/sudoku/

:- use_module(library(clpfd)).

sudoku(Rows) :-
    length(Rows, 9),
    valid_rows(Rows),
    transpose(Rows, Columns),
    valid_rows(Columns),
    blocks(Rows, Blocks),
    valid_rows(Blocks).

blocks([], []).
blocks([[], [], []|Rows], Blocks) :- blocks(Rows, Blocks).
blocks([[A, B, C|Row1], [D, E, F|Row2], [G, H, I|Row3]|Rows], [[A, B, C, D, E, F, G, H, I]|Rest]) :-
    blocks([Row1, Row2, Row3|Rows], Rest).

valid_rows([]).
valid_rows([Row|Rows]) :- valid_row(Row), valid_rows(Rows).

valid_row(Row) :- length(Row, 9), Row ins 1..9, all_distinct(Row).

board([[1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9]]).

board2([[1, 2, 3, 4, 5, 6, 7, 8, 9],
        [2, 3, 4, 5, 6, 7, 8, 9, 1],
        [3, 4, 5, 6, 7, 8, 9, 1, 2],
        [4, 5, 6, 7, 8, 9, 1, 2, 3],
        [5, 6, 7, 8, 9, 1, 2, 3, 4],
        [6, 7, 8, 9, 1, 2, 3, 4, 5],
        [7, 8, 9, 1, 2, 3, 4, 5, 6],
        [8, 9, 1, 2, 3, 4, 5, 6, 7],
        [9, 1, 2, 3, 4, 5, 6, 7, 8]]).

board3([[1, 2, 3, 4, 5, 6, 7, 8, 9],
        [4, 5, 6, 7, 8, 9, 1, 2, 3],
        [7, 8, 9, 1, 2, 3, 4, 5, 6],
        [2, 1, 4, 3, 6, 5, 8, 9, 7],
        [3, 6, 5, 8, 9, 7, 2, 1, 4],
        [8, 9, 7, 2, 1, 4, 3, 6, 5],
        [5, 3, 1, 6, 4, 2, 9, 7, 8],
        [6, 4, 2, 9, 7, 8, 5, 3, 1],
        [9, 7, 8, 5, 3, 1, 6, 4, 2]]).

:- board(X), \+ sudoku(X).
:- board2(X), \+ sudoku(X).
:- board3(X), sudoku(X).

:- sudoku([[1, 2, 3, 4, 5, 6, 7, 8, 9],
           [4, 5, 6, 7, 8, 9, 1, 2, 3],
           [7, 8, 9, 1, 2, 3, 4, 5, 6],
           [2, 1, 4, 3, 6, 5, 8, 9, 7],
           [3, 6, 5, 8, 9, 7, 2, 1, 4],
           [8, 9, 7, 2, 1, 4, 3, 6, 5],
           [5, 3, 1, 6, 4, 2, 9, 7, 8],
           [6, 4, 2, 9, 7, 8, 5, 3, 1],
           [X, 7, 8, 5, 3, 1, 6, 4, 2]]),
   print(X).

problem(1, P) :- % shokyuu
    P = [[1,_,_,8,_,4,_,_,_],
         [_,2,_,_,_,_,4,5,6],
         [_,_,3,2,_,5,_,_,_],
         [_,_,_,4,_,_,8,_,5],
         [7,8,9,_,5,_,_,_,_],
         [_,_,_,_,_,6,2,_,3],
         [8,_,1,_,_,_,7,_,_],
         [_,_,_,1,2,3,_,8,_],
         [2,_,5,_,_,_,_,_,9]].


problem(2, P) :-  % shokyuu
    P = [[_,_,2,_,3,_,1,_,_],
         [_,4,_,_,_,_,_,3,_],
         [1,_,5,_,_,_,_,8,2],
         [_,_,_,2,_,_,6,5,_],
         [9,_,_,_,8,7,_,_,3],
         [_,_,_,_,4,_,_,_,_],
         [8,_,_,_,7,_,_,_,4],
         [_,9,3,1,_,_,_,6,_],
         [_,_,7,_,6,_,5,_,_]].

problem(3, P) :-
    P = [[1,_,_,_,_,_,_,_,_],
         [_,_,2,7,4,_,_,_,_],
         [_,_,_,5,_,_,_,_,4],
         [_,3,_,_,_,_,_,_,_],
         [7,5,_,_,_,_,_,_,_],
         [_,_,_,_,_,9,6,_,_],
         [_,4,_,_,_,6,_,_,_],
         [_,_,_,_,_,_,_,7,1],
         [_,_,_,_,_,1,_,3,_]].

:- problem(1, X),
   sudoku(X),
   print(X).
